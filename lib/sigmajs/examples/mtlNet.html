<!DOCTYPE html>
<html>
<head>
	<title>Montreal Neuroscience Network</title>
	<link href='http://fonts.googleapis.com/css?family=Lato:300,700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">
	<link rel="stylesheet" href="./mtlNet.css">
</head>
<body>

	<nav class="navbar navbar-expand-lg navbar-light bg-light">
		<a class="navbar-brand" href="#">NeuroNet</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>

		<div class="collapse navbar-collapse" id="navbarSupportedContent">
			<ul class="navbar-nav mr-auto">
				<li class="nav-item active">
					<a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="#">Link</a>
				</li>
				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
						Dropdown
					</a>
					<div class="dropdown-menu" aria-labelledby="navbarDropdown">
						<a class="dropdown-item" href="#">Action</a>
						<a class="dropdown-item" href="#">Another action</a>
						<div class="dropdown-divider"></div>
						<a class="dropdown-item" href="#">Something else here</a>
					</div>
				</li>
				<li class="nav-item">
					<a class="nav-link disabled" href="#">Disabled</a>
				</li>
			</ul>
			<form class="form-inline my-2 my-lg-0">
				<input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
				<button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
			</form>
		</div>
	</nav>

	<div id="container">

		<div id="graph-container">
			<!--This is where the graph goes-->
		</div>

		<input id="search" type="text" name="search" placeholder="Search...">
		
		<div id="control-pane">
			<h2 class="underline">Filters</h2>
			<div>
				<h3>min connections: <span id="min-degree-val">0</span></h3>
				0 <input id="min-degree" type="range" min="0" max="0" value="0"> <span id="max-degree-value">0</span>
				<br>
			</div>
			<div>
				<h3>node category</h3>
				<select id="node-category">
					<option value="" selected>All categories</option>
				</select>
			</div>
			<span class="line"></span>
			<div>
				<button id="reset-btn">Reset filters</button>
				<button id="export-btn">Export</button>
			</div>
			<div id="dump" class="hidden"></div>
		</div>

		
	</div>
</body>

<!-- BOOTSTRAP -->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4" crossorigin="anonymous"></script>

<!-- START SIGMA IMPORTS -->
<script src="../src/sigma.core.js"></script>
<script src="../src/conrad.js"></script>
<script src="../src/utils/sigma.utils.js"></script>
<script src="../src/utils/sigma.polyfills.js"></script>
<script src="../src/sigma.settings.js"></script>
<script src="../src/classes/sigma.classes.dispatcher.js"></script>
<script src="../src/classes/sigma.classes.configurable.js"></script>
<script src="../src/classes/sigma.classes.graph.js"></script>
<script src="../src/classes/sigma.classes.camera.js"></script>
<script src="../src/classes/sigma.classes.quad.js"></script>
<script src="../src/classes/sigma.classes.edgequad.js"></script>
<script src="../src/captors/sigma.captors.mouse.js"></script>
<script src="../src/captors/sigma.captors.touch.js"></script>
<script src="../src/renderers/sigma.renderers.canvas.js"></script>
<script src="../src/renderers/sigma.renderers.webgl.js"></script>
<script src="../src/renderers/sigma.renderers.svg.js"></script>
<script src="../src/renderers/sigma.renderers.def.js"></script>
<script src="../src/renderers/webgl/sigma.webgl.nodes.def.js"></script>
<script src="../src/renderers/webgl/sigma.webgl.nodes.fast.js"></script>
<script src="../src/renderers/webgl/sigma.webgl.edges.def.js"></script>
<script src="../src/renderers/webgl/sigma.webgl.edges.fast.js"></script>
<script src="../src/renderers/webgl/sigma.webgl.edges.arrow.js"></script>
<script src="../src/renderers/canvas/sigma.canvas.labels.def.js"></script>
<script src="../src/renderers/canvas/sigma.canvas.hovers.def.js"></script>
<script src="../src/renderers/canvas/sigma.canvas.nodes.def.js"></script>
<script src="../src/renderers/canvas/sigma.canvas.edges.def.js"></script>
<script src="../src/renderers/canvas/sigma.canvas.edges.curve.js"></script>
<script src="../src/renderers/canvas/sigma.canvas.edges.arrow.js"></script>
<script src="../src/renderers/canvas/sigma.canvas.edges.curvedArrow.js"></script>
<script src="../src/renderers/canvas/sigma.canvas.edgehovers.def.js"></script>
<script src="../src/renderers/canvas/sigma.canvas.edgehovers.curve.js"></script>
<script src="../src/renderers/canvas/sigma.canvas.edgehovers.arrow.js"></script>
<script src="../src/renderers/canvas/sigma.canvas.edgehovers.curvedArrow.js"></script>
<script src="../src/renderers/canvas/sigma.canvas.extremities.def.js"></script>
<script src="../src/renderers/svg/sigma.svg.utils.js"></script>
<script src="../src/renderers/svg/sigma.svg.nodes.def.js"></script>
<script src="../src/renderers/svg/sigma.svg.edges.def.js"></script>
<script src="../src/renderers/svg/sigma.svg.edges.curve.js"></script>
<script src="../src/renderers/svg/sigma.svg.labels.def.js"></script>
<script src="../src/renderers/svg/sigma.svg.hovers.def.js"></script>
<script src="../src/middlewares/sigma.middlewares.rescale.js"></script>
<script src="../src/middlewares/sigma.middlewares.copy.js"></script>
<script src="../src/misc/sigma.misc.animation.js"></script>
<script src="../src/misc/sigma.misc.bindEvents.js"></script>
<script src="../src/misc/sigma.misc.bindDOMEvents.js"></script>
<script src="../src/misc/sigma.misc.drawHovers.js"></script>
<!-- END SIGMA IMPORTS -->
<script src="../plugins/sigma.parsers.json/sigma.parsers.json.js"></script>
<script src="../plugins/sigma.plugins.filter/sigma.plugins.filter.js"></script>
<script src="../plugins/sigma.plugins.dragNodes/sigma.plugins.dragNodes.js"></script>

<script>

var filter, dragListener;
// DOM utility functions
var _ = {
 	$: function(id) {
 		return document.getElementById(id);
 	},

 	all: function(selectors) {
 		return document.querySelectorAll(selectors);
 	},

 	removeClass: function(selectors, cssClass) {
 		var nodes = document.querySelectorAll(selectors);
 		var l = nodes.length;
 		for ( i = 0 ; i < l; i++ ) {
 			var el = nodes[i];
		// Bootstrap compatibility
		el.className = el.className.replace(cssClass, '');
		}
	},

	addClass: function(selectors, cssClass) {
		var nodes = document.querySelectorAll(selectors);
		var l = nodes.length;
		for ( i = 0 ; i < l; i++ ) {
			var el = nodes[i];
			// Bootstrap compatibility
			if (-1 == el.className.indexOf(cssClass)) {
				el.className += ' ' + cssClass;
			}
		}
	},

	show: function(selectors) {
		this.removeClass(selectors, 'hidden');
	},

	hide: function(selectors) {
		this.addClass(selectors, 'hidden');
	},

	toggle: function(selectors, cssClass) {
		var cssClass = cssClass || "hidden";
		var nodes = document.querySelectorAll(selectors);
		var l = nodes.length;
		for ( i = 0 ; i < l; i++ ) {
			var el = nodes[i];
			//el.style.display = (el.style.display != 'none' ? 'none' : '' );
			// Bootstrap compatibility
			if(-1 !== el.className.indexOf(cssClass)) {
				el.className = el.className.replace(cssClass, '');
			} else {
				el.className += ' ' + cssClass;
			}
		}
	}
};


function updatePane(graph, filter) {
	// get max degree
	var maxDegree = 0,
	categories = {};

	// read nodes
	graph.nodes().forEach(function(n) {
		maxDegree = Math.max(maxDegree, graph.degree(n.id));
		categories[n.affiliation] = true;
	})

	//graph.refresh();

	// min degree
	_.$('min-degree').max = maxDegree;
	_.$('max-degree-value').textContent = maxDegree;

	// node category
	var nodecategoryElt = _.$('node-category');
	Object.keys(categories).forEach(function(c) {
		var optionElt = document.createElement("option");
		if(c.split(',').length==1) {
			optionElt.text = c;
			nodecategoryElt.add(optionElt);
		}
	});

	// reset button
	_.$('reset-btn').addEventListener("click", function(e) {
		_.$('min-degree').value = 0;
		_.$('min-degree-val').textContent = '0';
		_.$('node-category').selectedIndex = 0;
		filter.undo().apply();
		_.$('dump').textContent = '';
		_.hide('#dump');
	});

	// export button
	_.$('export-btn').addEventListener("click", function(e) {
		var chain = filter.export();
		console.log(chain);
		_.$('dump').textContent = JSON.stringify(chain);
		_.show('#dump');
	});
}

window.s = new sigma({ 
	renderers: [{
		container: 'graph-container', 
		type: 'canvas'
	}],
	settings: {} 
});

sigma.parsers.json('data/neural9.json', function(graph) {
	s.graph.read(graph);
	s.refresh();
	s.graph.edges().forEach(function(e) {
		e.color = "rgba(32,32,32,0.1)";
	});
	s.refresh();

	// Initialize the Filter API
	filter = new sigma.plugins.filter(s);
	// Initialize the dragNodes plugin:
	dragListener = new sigma.plugins.dragNodes(s, s.renderers[0]);

	updatePane(s.graph, filter);

	function applyMinDegreeFilter(e) {
		var v = e.target.value;
		_.$('min-degree-val').textContent = v;

		filter
		.undo('min-degree')
		.nodesBy(function(n) {
			return this.degree(n.id) >= v;
		}, 'min-degree')
		.apply();
	}

	function applyCategoryFilter(e) {
		var c = e.target[e.target.selectedIndex].value;
		filter
		.undo('node-category')
		.nodesBy(function(n) {
			return !c.length || n.affiliation.indexOf(c) > -1;
		}, 'node-category')
		.apply();
	}

	_.$('min-degree').addEventListener("input", applyMinDegreeFilter);// for Chrome and FF
	_.$('min-degree').addEventListener("change", applyMinDegreeFilter); // for IE10+, that sucks
	_.$('node-category').addEventListener("change", applyCategoryFilter);

});



</script>

</html>